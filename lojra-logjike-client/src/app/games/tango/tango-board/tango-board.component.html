<svg
  [attr.width]="svgWidth"
  [attr.height]="svgHeight"
  [attr.viewBox]="'0 0 ' + svgWidth + ' ' + svgHeight"
  class="tango-board"
>
  <defs>
    <!-- Conflict pattern -->
    <pattern id="tangoConflict" patternUnits="userSpaceOnUse" width="6" height="6" patternTransform="rotate(45)">
      <line x1="0" y1="0" x2="0" y2="6" stroke="#DC2626" stroke-width="2" stroke-opacity="0.25"/>
    </pattern>
  </defs>

  <!-- Cell backgrounds -->
  @for (i of cells; track i) {
    <rect
      [attr.x]="cellX(i)"
      [attr.y]="cellY(i)"
      [attr.width]="cellSize"
      [attr.height]="cellSize"
      [attr.fill]="isPrefilled(i) ? '#FFF7ED' : '#FFFFFF'"
    />
  }

  <!-- Grid lines -->
  @for (line of horizontalGridLines; track line.y) {
    <line [attr.x1]="0" [attr.y1]="line.y" [attr.x2]="svgWidth" [attr.y2]="line.y" stroke="#e0e0e0" stroke-width="1"/>
  }
  @for (line of verticalGridLines; track line.x) {
    <line [attr.x1]="line.x" [attr.y1]="0" [attr.x2]="line.x" [attr.y2]="svgHeight" stroke="#e0e0e0" stroke-width="1"/>
  }

  <!-- Board border -->
  <rect x="0.5" y="0.5" [attr.width]="svgWidth - 1" [attr.height]="svgHeight - 1" fill="none" stroke="#1a1a1a" stroke-width="2" rx="2"/>

  <!-- Conflict overlays -->
  @for (i of cells; track i) {
    @if (isConflict(i)) {
      <rect
        [attr.x]="cellX(i)"
        [attr.y]="cellY(i)"
        [attr.width]="cellSize"
        [attr.height]="cellSize"
        fill="url(#tangoConflict)"
      />
    }
  }

  <!-- Hint highlights -->
  @for (i of cells; track i) {
    @if (isHintCell(i)) {
      <rect
        [attr.x]="cellX(i) + 3"
        [attr.y]="cellY(i) + 3"
        [attr.width]="cellSize - 6"
        [attr.height]="cellSize - 6"
        fill="#FDE68A"
        fill-opacity="0.45"
        rx="6"
      />
    }
  }

  <!-- Sun symbols: simple filled circle -->
  @for (i of cells; track i) {
    @if (isSun(i)) {
      <circle
        [attr.cx]="cellCenterX(i)"
        [attr.cy]="cellCenterY(i)"
        [attr.r]="symbolRadius"
        fill="#F59E0B"
        [attr.opacity]="isPrefilled(i) ? 0.65 : 1"
      />
    }
  }

  <!-- Moon symbols: filled crescent -->
  @for (i of cells; track i) {
    @if (isMoon(i)) {
      <path
        [attr.d]="moonPath(cellCenterX(i), cellCenterY(i))"
        fill="#6366F1"
        [attr.opacity]="isPrefilled(i) ? 0.65 : 1"
      />
    }
  }

  <!-- Constraint indicators (= or Ã—) on cell borders -->
  @for (ct of constraintDisplays; track $index) {
    <!-- Background circle for constraint -->
    <circle
      [attr.cx]="ct.x"
      [attr.cy]="ct.y"
      r="10"
      fill="white"
      stroke="#d4d4d4"
      stroke-width="1"
    />
    <text
      [attr.x]="ct.x"
      [attr.y]="ct.y"
      text-anchor="middle"
      dominant-baseline="central"
      font-size="13"
      font-weight="800"
      [attr.fill]="ct.symbol === '=' ? '#F97316' : '#DC2626'"
      style="pointer-events: none; font-family: system-ui, sans-serif;"
    >{{ ct.symbol }}</text>
  }

  <!-- Click interaction layer -->
  @for (i of cells; track i) {
    <rect
      [attr.x]="cellX(i)"
      [attr.y]="cellY(i)"
      [attr.width]="cellSize"
      [attr.height]="cellSize"
      fill="transparent"
      [style.cursor]="isPrefilled(i) ? 'default' : 'pointer'"
      (click)="onCellClick(i)"
    />
  }
</svg>
